# problem

이제는 폰트크기가 근접하게 되었다.

현재는 2가지 문제가 있다.



1. 이미지가 깨끗하게 지워지지 않는다는 문제(랜덤하게)

2. 폰트가 원본과 근접하게 되긴 했지만, 줄바꿈이 자연스럽지 않거나, 같은 위계간의 폰트 크기가 일치하지 않는 문제 등이 있다.



자, 일단 이것을 어떻게 해결할지 의견을 제시하라.


# solution by gemini 3 pro

문제점을 정확히 짚어주셨습니다. 현재 발생한 두 가지 문제의 원인과 이를 해결하기 위한 **구체적인 기술적 해법**을 제안합니다.

---

### 1. 이미지 잔여물 문제 (Clean Inpainting)

**원인:**
현재 사용 중인 `cv2.inpaint` (Telea 알고리즘)는 AI가 아니라 주변 픽셀을 물리적으로 '문지르는(Smudging)' 방식입니다. 따라서 글자가 굵거나 배경이 복잡하면(그라데이션 등) 지운 흔적이 얼룩처럼 남거나, 글자 외곽선이 미세하게 남는 문제가 발생합니다.

**해결 방안: "Mask Dilation(팽창) & AI 모델 도입"**

1. **마스크 팽창 (즉시 적용 가능):**
* 현재는 단순히 사각형(`rectangle`)으로 가리지만, 글자의 삐침이나 획이 박스 경계에 걸치면 지워지지 않습니다.
* **Morphological Dilation** 기술을 적용하여 마스크 영역을 강제로 2~3픽셀 더 두껍게 확장시킵니다. 이렇게 하면 글자 주변부까지 확실하게 '구멍'을 낸 뒤 채우므로 잔여물이 사라집니다.


2. **AI Inpainting 라이브러리 (권장):**
* Colab 환경이라면 `cv2`의 한계를 넘어설 때가 되었습니다. `simple-lama-inpainting` 같은 경량 딥러닝 라이브러리를 설치하여 적용하면, 주변 패턴을 인식하여 감쪽같이 채워줍니다. (다만, 설치 시간이 조금 더 걸립니다. 우선은 **마스크 팽창**으로 해결을 시도하는 것이 효율적입니다.)



---

### 2. 폰트 위계 및 줄바꿈 부자연스러움 (Typography)

**원인:**
현재 로직은 **"각 텍스트 박스마다 개별적으로"** 폰트 크기를 계산합니다.

* **문제 상황:** 같은 '본문'이라도 A박스는 3줄, B박스는 2줄일 때, 박스의 여백이 조금만 달라도 계산된 폰트 크기(px)가 미세하게 달라집니다. (예: A는 14px, B는 14.5px → 시각적으로 거슬림)
* **줄바꿈:** 브라우저의 자동 줄바꿈(`white-space: normal`)에 의존하고 있어, 박스 너비가 타이트하면 원본과 다른 위치에서 줄이 바뀝니다.

**해결 방안: "Style Clustering(스타일 군집화) & Pre-wrap"**

1. **스타일 군집화 (Style Clustering):**
* 개별 계산된 폰트 크기를 그대로 쓰지 않고 **'자석처럼 붙이는'** 후처리 로직을 추가합니다.
* **로직:** 전체 텍스트의 폰트 크기를 분석하여, 서로 **오차 범위(±10%) 내에 있는 값들은 하나의 그룹으로 묶습니다.**
* **적용:** 그룹 내의 **중간값(Median)**으로 통일시킵니다.
* *효과:* 제목은 제목끼리, 본문은 본문끼리 기계적으로 완전히 동일한 폰트 사이즈를 갖게 됩니다.


2. **강제 줄바꿈 존중:**
* CSS 속성을 `white-space: pre-wrap`으로 변경합니다.
* Gemini가 분석한 줄바꿈(`\n`)을 그대로 따르게 하고, 박스 너비(`width`)에 **약 5%의 여유 buffer**를 주어 브라우저가 멋대로 줄을 바꾸지 못하게 막습니다.



---

### ✅ 제안하는 수정 방향 (Action Plan)

다음 단계에서 코드를 수정할 때, 아래 두 가지 핵심 기능을 추가하겠습니다.

1. **`Image Processor` 강화:** `cv2.dilate`를 사용하여 마스크를 더 과감하게 넓혀 잔여물을 없앱니다.
2. **`Font Standardizer` 추가:**
* 1차로 기하학적 폰트 크기를 계산한 뒤,
* **K-Means 유사 알고리즘**을 통해 비슷한 크기끼리 묶어(Clustering) 폰트 크기를 **표준화(Normalization)**시킵니다.



이 방향으로 코드를 업데이트하여 진행해도 괜찮을까요?